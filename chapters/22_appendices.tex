\appendix


\chapter{MLIR benchmark results}
\label{chap:mlir-benchmark-results}

\section{Pipeline phase micro-benchmark results}
% Commands to run
% Table of results

\section{How Slow is MLIR micro-benchmark results}
% Commands to run
% Table of results


\chapter{xDSL benchmark results}
\label{chap:mlir-benchmark-results}

\section{Pipeline phase micro-benchmark results}
% Commands to run
% Table of results

\section{Micro-benchmark results}
% Commands to run
% Table of results




\chapter{Bytecode profiles}
\label{chap:bytecode-profiles}

\begin{code}
    \begin{minted}[fontsize=\footnotesize]{text}
//// Trace of `has_trait_function` :

// ====== trace:403 `has_trait_function` =======                                == 61.537us
// >>> assert OP_WITH_REGION.has_trait(                                         ## 5.624us
404         2   LOAD_GLOBAL          0   (OP_WITH_REGION)                       // 1.250us
404         12  LOAD_ATTR            3   (NULL|self + has_trait)                // 583.008ns
// >>> Trait0                                                                   ## 4.500us
405         32  LOAD_GLOBAL          4   (Trait0)                               // 500.004ns
// >>> assert OP_WITH_REGION.has_trait(                                         ## 4.000us
404         42  CALL                 1   ()                                     // 291.970ns

    // ====== core:1164 `Operation.has_trait` ======                            == 45.370us
    // >>> from xdsl.dialects.builtin import UnregisteredOp                     ## 8.707us
    1176         2   LOAD_CONST           1   (0)                               // 500.004ns
    1176         4   LOAD_CONST           2   (('UnregisteredOp',))             // 333.006ns
    1176         6   IMPORT_NAME          0   (xdsl.dialects.builtin)           // 250.002ns
    1176         8   IMPORT_FROM          1   (UnregisteredOp)                  // 3.166us
    1176         10  STORE_FAST           3   (UnregisteredOp)                  // 458.967ns
    1176         12  POP_TOP                  ()                                // 208.034ns
    // >>> if issubclass(cls, UnregisteredOp):                                  ## 5.834us
    1178         14  LOAD_GLOBAL          5   (NULL + issubclass)               // 291.970ns
    1178         24  LOAD_FAST            0   (cls)                             // 250.002ns
    1178         26  LOAD_FAST            3   (UnregisteredOp)                  // 1.000us
    1178         28  CALL                 2   ()                                // 250.002ns

        //  <frozen abc>:121 `ABCMeta.__subclasscheck__`                        == 4.499us
        // >>> <source not available>                                           ## 2.750us
        123         2   LOAD_GLOBAL          1   (NULL + _abc_subclasscheck)    // 374.974ns
        123         12  LOAD_FAST            0   (cls)                          // 375.032ns
        123         14  LOAD_FAST            1   (subclass)                     // 209.024ns
        123         16  CALL                 2   ()                             // 250.002ns
        123         24  RETURN_VALUE             ()                             // 1.250us
        // =============================================

    1178         36  POP_JUMP_IF_FALSE    2   (to 42)                           // 459.026ns
    // >>> return cls.get_trait(trait) is not None                              ## 5.955us
    1181     >>  42  LOAD_FAST            0   (cls)                             // 291.038ns
    1181         44  LOAD_ATTR            7   (NULL|self + get_trait)           // 290.980ns
    1181         64  LOAD_FAST            1   (trait)                           // 790.984ns
    1181         66  CALL                 1   ()                                // 915.956ns

        // ====== core:1183 `Operation.get_trait` ======                        == 27.540us
        // >>> if isinstance(trait, type):                                      ## 5.250us
        1188         2   LOAD_GLOBAL          1   (NULL + isinstance)           // 250.002ns
        1188         12  LOAD_FAST            1   (trait)                       // 541.972ns
        1188         14  LOAD_GLOBAL          2   (type)                        // 250.002ns
        1188         24  CALL                 2   ()                            // 333.006ns
        1188         32  POP_JUMP_IF_FALSE    55  (to 144)                      // 250.002ns
        // >>> for t in cls.traits:                                             ## 4.832us
        1189         34  LOAD_FAST            0   (cls)                         // 290.980ns
        1189         36  LOAD_ATTR            4   (traits)                      // 291.038ns
        1189         56  GET_ITER                 ()                            // 624.976ns

            // ======= core:747 `OpTraits.__iter__` ========                    == 9.832us
            // >>> return iter(self.traits)                                     ## 4.668us
            748         2   LOAD_GLOBAL          1   (NULL + iter)              // 291.970ns
            748         12  LOAD_FAST            0   (self)                     // 500.004ns
            748         14  LOAD_ATTR            2   (traits)                   // 250.002ns

                // ======== core:736 `OpTraits.traits` =========                == 6.331us
                // >>> if callable(self._traits):                               ## 4.458us
                739         2   LOAD_GLOBAL          1   (NULL + callable)      // 250.002ns
                739         12  LOAD_FAST            0   (self)                 // 333.006ns
                739         14  LOAD_ATTR            2   (_traits)              // 208.034ns
                739         34  CALL                 1   ()                     // 2.167us
                739         42  POP_JUMP_IF_FALSE    30  (to 104)               // 458.036ns
                // >>> return self._traits                                      ## 957.050ns
                741     >>  104 LOAD_FAST            0   (self)                 // 208.034ns
                741         106 LOAD_ATTR            2   (_traits)              // 208.034ns
                741         126 RETURN_VALUE             ()                     // 290.980ns
                // =============================================

            748         34  CALL                 1   ()                         // 292.028ns
            748         42  RETURN_VALUE             ()                         // 499.946ns
            // =============================================

        1189     >>  58  FOR_ITER             39  (to 140)                      // 500.004ns
        1189         62  STORE_FAST           2   (t)                           // 1.917us
        // >>> if isinstance(t, cast(type[OpTraitInvT], trait)):                ## 5.415us
        1190         64  LOAD_GLOBAL          1   (NULL + isinstance)           // 374.974ns
        1190         74  LOAD_FAST            2   (t)                           // 416.010ns
        1190         76  LOAD_GLOBAL          7   (NULL + cast)                 // 250.002ns
        1190         86  LOAD_GLOBAL          2   (type)                        // 416.010ns
        1190         96  LOAD_GLOBAL          8   (OpTraitInvT)                 // 250.002ns
        1190         106 BINARY_SUBSCR            ()                            // 374.974ns
        1190         110 LOAD_FAST            1   (trait)                       // 707.980ns
        1190         112 CALL                 2   ()                            // 250.002ns

            // ============ typing:2187 `cast` =============                    == 2.668us
            // >>> return val                                                   ## 1.251us
            2195         2   LOAD_FAST            1   (val)                     // 667.002ns
            2195         4   RETURN_VALUE             ()                        // 291.970ns
            // =============================================

        1190         120 CALL                 2   ()                            // 667.002ns
        1190         128 POP_JUMP_IF_TRUE     1   (to 132)                      // 250.002ns
        // >>> return t                                                         ## 1.750us
        1191     >>  132 LOAD_FAST            2   (t)                           // 333.006ns
        1191         134 SWAP                 2   ()                            // 250.002ns
        1191         136 POP_TOP                  ()                            // 249.944ns
        1191         138 RETURN_VALUE             ()                            // 583.008ns
        // =============================================

    1181         74  LOAD_CONST           3   (None)                            // 624.976ns
    1181         76  IS_OP                1   ()                                // 292.028ns
    1181         78  RETURN_VALUE             ()                                // 290.980ns
    // =============================================

404         50  POP_JUMP_IF_TRUE     2   (to 56)                                // 624.976ns
404     >>  56  RETURN_CONST         0   (None)                                 // 333.996ns
// =============================================
    \end{minted}
    \caption{Bytecode profile trace of the original implementation of \mintinline{python}{has_trait}.}
    \label{listing:bytecode-profiles-hastrait-original}
\end{code}

\vspace{2em}

\begin{code}
    \begin{minted}[fontsize=\footnotesize]{text}
//// Trace of `has_trait_function_optimised` :

// = trace:408 `has_trait_function_optimised` ==                      == 18.708us
// >>> has_trait = False                                              ## 2.083us
409         2   LOAD_CONST           1   (False)                      // 666.012ns
409         4   STORE_FAST           0   (has_trait)                  // 459.026ns
// >>> for t in OP_WITH_REGION.traits._traits:                        ## 2.708us
410         6   LOAD_GLOBAL          0   (OP_WITH_REGION)             // 250.002ns
410         16  LOAD_ATTR            2   (traits)                     // 291.970ns
410         36  LOAD_ATTR            4   (_traits)                    // 291.970ns
410         56  GET_ITER                 ()                           // 292.028ns
410     >>  58  FOR_ITER             22  (to 106)                     // 333.006ns
410         62  STORE_FAST           1   (t)                          // 333.006ns
// >>> if isinstance(t, Trait0):                                      ## 2.167us
411         64  LOAD_GLOBAL          7   (NULL + isinstance)          // 292.028ns
411         74  LOAD_FAST            1   (t)                          // 250.002ns
411         76  LOAD_GLOBAL          8   (Trait0)                     // 250.002ns
411         86  CALL                 2   ()                           // 250.002ns
411         94  POP_JUMP_IF_TRUE     1   (to 98)                      // 292.028ns
// >>> has_trait = True                                               ## 1.374us
412     >>  98  LOAD_CONST           2   (True)                       // 290.980ns
412         100 STORE_FAST           0   (has_trait)                  // 250.002ns
// >>> break                                                          ## 1.415us
413         102 POP_TOP                  ()                           // 290.980ns
413         104 JUMP_FORWARD         1   (to 108)                     // 290.980ns
// >>> assert has_trait                                               ## 1.042us
414     >>  108 LOAD_FAST            0   (has_trait)                  // 291.038ns
414         110 POP_JUMP_IF_TRUE     2   (to 116)                     // 209.024ns
414     >>  116 RETURN_CONST         0   (None)                       // 291.970ns
// =============================================
    \end{minted}
    \caption{Bytecode profile trace of the optimised implementation of \mintinline{python}{has_trait}.}
    \label{listing:bytecode-profiles-hastrait-optimised}
\end{code}

% \chapter{Technical details, proofs, etc.}

% Appendices are for optional materials that is not essential to
% understanding the work, and that the examiners are not expected to
% read, but that will be of value to readers interested in additional,
% in-depth technical detail.

% \begin{code}
%     \begin{minted}{haskell}
%         newtype Lasagne = Lasagne Int
%             deriving (Show, Num)

%         -- The stacking operating can be considered integer
%         -- addition of the number of layers
%         instance Semigroup Lasagne where
%             (<>) = (+)

%         -- The identity element is the empty (zero-layer) Lasagne
%         instance Monoid Lasagne where
%             mempty = Lasagne 0

%         -- Stacking 5 and 6 layers gives 11 layers:
%         --
%         -- ghci> Lasagne 5 <> Lasagne 6
%         -- Lasagne 11
%     \end{minted}
%     \caption{A Haskell implementation of the Lasagne monoid, which is not an endofunctor.}
%     \label{}
% \end{code}